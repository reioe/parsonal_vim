# コード整形 in Vim マークアップテーブル構造編

私はコード整形が大好きだ。ユニットテストじゃ準備段階での値代入だのAssertだので
これをやらないと気が済まない。
あとマークアップ言語の表構造とか。
リーダブルコードでも奨励されているし、労を惜しむよりやったほうがいいよと書いてあるよね。

そうは言ってもでもめんどくさい。好きだけど。スペースぺちぺち打ってる時間は至福だけれども。

というわけで、そんなコード整形を自動化してくれる僕らの味方がいるらしい。
それが[Align.vim](https://github.com/vim-scripts/Align)だ。やったね。

いつもどおり、neobundleからインストールしていこう。
neobundleで読み込む定義に以下を記述

```
NeoBundle 'vim-scripts/Align'
```

なんかVimスクリプトのエラーで怒られたよ。大丈夫か？
とりあえず、:NeoBundleListで見てみると
Alignは入っている。もう一度起動し直すと、メニューが表示されたし、Alignコマンドも使える。やったね。


## テーブル構造を整形する。

私はマークダウンのテーブル構造が大好きだ。
例えばこんなんが有りますよ。

```
|5(月)|6(火)|7(水)|8(木)|9(金)||13(火)|14(水)|15(木)|16(金)| 
|-----|-----|-----|-----|-----||------|------|------|------| 
|○   |○   |▲   |○   |○   ||○    |▲    |○    |○    | 
|×   |×   |×   |○   |○   ||○    |○    |×    |×    | 
|×   |○   |△   |×   |△   ||○    |△    |×    |△    | 
|○   |○   |△   |○   |△   ||○    |△    |○    |△    | 
|○   |○   |△   |×   |○   ||○    |△    |○    |○    | 
|△   |△   |△   |△   |△   ||△    |△    |△    |△    | 

```
これからはこんな風に崩した状態のものは一発で…

```
|5(月)|6(火)|7(水)|8(木)|9(金)||13(火)|14(水)|15(木)|16(金)| 
|-----|-----|-----|-----|-----||------|------|------|------| 
|○|○|▲|○  |○   ||○    |▲    |○    |○    | 
|×|×|×|○  |○ ||○  |○  |×  |×    | 
|×|○|△|×|△  ||○ |△    |×    |△    | 
|○|○|△|○|△   ||○  |△    |○    |△    | 
|○|○|△|×  |○   ||○ |△    |○    |○    | 
|△|△|△|△  |△   ||△  |△    |△    |△    | 

```

```
:Align|
```
こうじゃ！

```
 | 5(月)  | 6(火)  | 7(水)  | 8(木)  | 9(金)  |  | 13(火)  | 14(水)  | 15(木)  | 16(金)  | 
 | ----- | ----- | ----- | ----- | ----- |  | ------ | ------ | ------ | ------ | 
 | ○     | ○     | ▲     | ○     | ○     |  | ○      | ▲      | ○      | ○      | 
 | ×     | ×     | ×     | ○     | ○     |  | ○      | ○      | ×      | ×      | 
 | ×     | ○     | △     | ×     | △     |  | ○      | △      | ×      | △      | 
 | ○     | ○     | △     | ○     | △     |  | ○      | △      | ○      | △      | 
 | ○     | ○     | △     | ×     | ○     |  | ○      | △      | ○      | ○      | 
 | △     | △     | △     | △     | △     |  | △      | △      | △      | △      | 


```
微妙！
うーん。全角と半角が混じってるとイマイチのよう。
全角文字のサイズ計算として、
```
:let g:Align_xstrlen = 3
```
をvimrcに入れるといいようだよ。

再度！
```

 | 5(月) | 6(火) | 7(水) | 8(木) | 9(金) |  | 13(火) | 14(水) | 15(木) | 16(金) | 
 | ----- | ----- | ----- | ----- | ----- |  | ------ | ------ | ------ | ------ | 
 | ○    | ○    | ▲    | ○    | ○    |  | ○     | ▲     | ○     | ○     | 
 | ×    | ×    | ×    | ○    | ○    |  | ○     | ○     | ×     | ×     | 
 | ×    | ○    | △    | ×    | △    |  | ○     | △     | ×     | △     | 
 | ○    | ○    | △    | ○    | △    |  | ○     | △     | ○     | △     | 
 | ○    | ○    | △    | ×    | ○    |  | ○     | △     | ○     | ○     | 
 | △    | △    | △    | △    | △    |  | △     | △     | △     | △     | 
```
いい感じ！でも惜しい！問答無用で|の周りにスペース入れてほしくない。
その辺の条件は、:AlignCtrlコマンドで指定するらしい。
:AlignCtrlで条件指定→:Alignで実行、という流れ。

```
:AlignCtrl p0P0
:Align|
```

```
|5(月)|6(火)|7(水)|8(木)|9(金)||13(火)|14(水)|15(木)|16(金)|
|-----|-----|-----|-----|-----||------|------|------|------|
|○   |○   |▲   |○   |○   ||○    |▲    |○    |○    |
|×   |×   |×   |○   |○   ||○    |○    |×    |×    |
|×   |○   |△   |×   |△   ||○    |△    |×    |△    |
|○   |○   |△   |○   |△   ||○    |△    |○    |△    |
|○   |○   |△   |×   |○   ||○    |△    |○    |○    |
|△   |△   |△   |△   |△   ||△    |△    |△    |△    |
```

やったぜ！
とりあえずMarkdownのテーブル構造の整形はうまく出来ました。
次回はコードの整形についてやっていきます。

※ コードブロックしているところがCSSによっては崩れてて何言ってんだって感じかもしれないけど、
   等幅フォントでは綺麗なんですよ！なんですよ！

参考:
[名無しのvim使い:高性能なテキスト整形ツールAlignの使い方 #4 「:Align」コマンドを使用して整形処理を行う](http://nanasi.jp/articles/vim/align/align_vim_ctrl.html#id11)

